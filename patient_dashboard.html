{% extends "base.html" %}
{% block title %}Patient Dashboard{% endblock %}

{% block content %}
<h3 class="mb-3">Patient Dashboard</h3>

<div class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <h5>{{ patient.name }}</h5>
    <p class="text-muted mb-0">{{ patient.email }} | {{ patient.phone }}</p>
  </div>
  <div>
    <a href="{{ url_for('edit_profile') }}" class="btn btn-outline-secondary">Edit Profile</a>
    <a href="{{ url_for('search_doctors') }}" class="btn btn-primary">Search Doctors</a>
  </div>
</div>

<h5>Departments / Specializations</h5>
<ul class="list-group mb-3">
  {% for d in departments %}
  <li class="list-group-item d-flex justify-content-between align-items-center">
    <span>{{ d.name }}</span>
    <span class="text-muted small">{{ d.description }}</span>
  </li>
  {% else %}
  <li class="list-group-item text-center">No departments available</li>
  {% endfor %}
</ul>


<h5>Doctors' Availability (Next 7 Days)</h5>
<table class="table table-sm table-bordered">
  <thead>
    <tr>
      <th>Date</th>
      <th>Doctor</th>
      <th>Specialization</th>
      <th>Time</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody>
    {% for av in availabilities %}
    <tr>
      <td>{{ av.date }}</td>
      <td>{{ av.doctor.name }}</td>
      <td>{{ av.doctor.specialization }}</td>
      <td>{{ av.start_time.strftime('%H:%M') }} - {{ av.end_time.strftime('%H:%M') }}</td>
      <td>
        <a href="{{ url_for('book_appointment', doctor_id=av.doctor.id) }}" class="btn btn-sm btn-primary">
          Book
        </a>
      </td>
    </tr>
    {% else %}
    <tr><td colspan="5" class="text-center">No availability published</td></tr>
    {% endfor %}
  </tbody>
</table>

<h5 class="mt-4">Upcoming Appointments</h5>
<table class="table table-striped table-sm">
  <thead>
    <tr>
      <th>Date</th>
      <th>Time</th>
      <th>Doctor</th>
      <th>Status</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody>
    {% for a in upcoming_appointments %}
    <tr>
      <td>{{ a.date }}</td>
      <td>{{ a.time.strftime('%H:%M') }}</td>
      <td>{{ a.doctor.name }}</td>
      <td>{{ a.status }}</td>
      <td>
        <a href="{{ url_for('reschedule_appointment', appointment_id=a.id) }}" class="btn btn-sm btn-outline-primary">
          Reschedule
        </a>
        <a href="{{ url_for('cancel_appointment', appointment_id=a.id) }}" class="btn btn-sm btn-outline-danger">
          Cancel
        </a>
      </td>
    </tr>
    {% else %}
    <tr><td colspan="5" class="text-center">No upcoming appointments</td></tr>
    {% endfor %}
  </tbody>
</table>

<h5 class="mt-4">Recent Appointment History</h5>
<table class="table table-bordered table-sm">
  <thead>
    <tr>
      <th>Date</th>
      <th>Doctor</th>
      <th>Status</th>
    </tr>
  </thead>
  <tbody>
    {% for a in past_appointments %}
    <tr>
      <td>{{ a.date }}</td>
      <td>{{ a.doctor.name }}</td>
      <td>{{ a.status }}</td>
    </tr>
    {% else %}
    <tr><td colspan="3" class="text-center">No past appointments</td></tr>
    {% endfor %}
  </tbody>
</table>

<a href="{{ url_for('patient_history') }}" class="btn btn-outline-primary mt-2">View Full Treatment History</a>
{% endblock %}
